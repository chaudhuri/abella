<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Abella in your browser</title>
    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- ANGULAR -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular-cookies.min.js"></script>
    <!-- BOOTSTRAP -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" type="text/css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- ACE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js"></script>
    <!-- <script src="ace/ace.js"></script> -->
    <!-- ABELLA -->
    <script src="abella_js.js"></script>
    <!-- LOCAL -->
    <link href='http://fonts.googleapis.com/css?family=Lato:900' rel='stylesheet' type='text/css'>
    <!-- <link href='http://fonts.googleapis.com/css?family=Vollkorn:700' rel='stylesheet' type='text/css'> -->
    <style type="text/css">
      h1 { font-family: Lato, sans-serif; font-size: 36px; text-transform: uppercase; letter-spacing: .05ex;
           color: maroon; }
      .tab-pane { padding: 5px 5px; }
      .ace_editor { font: 12pt Inconsolata, monospace; width: 100%; height: 200px; margin:auto; }
      .ace_fake_editor { height: 2em; }
      .ace_abella { color: #2233FA !important; text-decoration: underline; }
      .ace_proof  { color: #5544AA !important; }
      .tab-pane code { color: inherit; }
      #trace { font: 12pt Inconsolata, monospace; height: 30em; overflow-y: auto; }
    </style>
    <script type="text/javascript" src="main.js"></script>
    <script type="text/javascript">
      $(function(){
        var aceTheme = 'ace/theme/eclipse';
        ace.config.set("modePath", "ace/");
        var makeEditor = function(key,mode,minLines,maxLines,id){
          var ed = ace.edit(id);
          ed.setTheme(aceTheme);
          ed.setOptions({autoScrollEditorIntoView: true, minLines: minLines, maxLines: maxLines});
          ed.getSession().setMode(mode);
          if(typeof(Storage) !== undefined){
            ed.$blockScrolling = Infinity;
            var cached = localStorage.getItem(key);
            if(cached !== null) ed.setValue(cached, -1);
            ed.on('input', function(){
               localStorage.setItem(key, ed.getValue());
            });
          }
          document[key] = ed;
        };
        makeEditor('specSigEd','ace/mode/lprolog',5,30,'spec-sig');
        makeEditor('specModEd','ace/mode/lprolog',5,30,'spec-mod');
        makeEditor('reasoningEd','ace/mode/abella',40,40,'reasoning');
        document.setValues = function(sig,mod,thm){
          if (sig !== null) document.specSigEd.setValue(sig, -1);
          if (mod !== null) document.specModEd.setValue(mod, -1);
          if (thm !== null) document.reasoningEd.setValue(thm, -1);
        }
        document.refreshEditors = function(){
          [document.specSigEd, document.specModEd, document.reasoningEd]
          .forEach(function(ed){
            ed.resize();
            ed.renderer.updateFull();
          });
        };
      });
    </script>
  </head>
  <body ng-app="main">
    <div id="container" class="container-fluid">
      <div id="page-header" class="page-header">
        <img class="pull-right"
             src="http://abella-prover.org/images/logo.png"
             height="100px" alt="[ABELLA LOGO]"><br>
        <h1>Try It Out!</h1>
      </div>

      <div id="load" class="panel" ng-controller="LoadController as load">
        <select ng-model="myDev"
                ng-change="load.select(myDev)"
                ng-options="dev.name disable when dev.disable for dev in devs"
                id="load-list">
          <option value="" disabled>-- select an existing example --</option>
        </select>
      </div>

      <div id="files" ng-controller="TabController as tab">
        <ul class="nav nav-tabs">
          <li ng-class="{active:tab.isSet(1)}"><a href ng-click="tab.set(1)">Specification</a></li>
          <li ng-class="{active:tab.isSet(2)}"><a href ng-click="tab.set(2)">Reasoning</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane row" ng-class="{active:tab.isSet(1)}">
            <div class="col-md-6" id="sig-column">
              Signature (<code>.sig</code>)<br>
              <pre id="spec-sig">sig spec.
%% Signature here</pre>
            </div> <!-- sig-column -->
            <div class="col-md-6" id="mod-column">
              Module (<code>.mod</code>)<br>
              <pre id="spec-mod">module spec.
%% Module here</pre>
            </div> <!-- mod-column -->
          </div>

          <div class="tab-pane row" ng-class="{active:tab.isSet(2)}">
            <div class="col-md-7" id="thm-column">
              <pre id="reasoning">%% Reasoning file here</pre>
            </div> <!-- thm-column -->
            <div class="col-md-5" ng-controller="TraceController as trace" id="trace-column">
              <pre ng-class="trace.getBackground()" id="trace" scroll="output">{{trace.output}}</pre>
              <div class="pull-right" id="trace-buttons">
                <input type="button" value="(Re)Start Abella" ng-click="trace.redo()">
                <input type="button" value="Go on!" ng-click="trace.goOn()">
              </div> <!-- trace-buttons -->
            </div> <!-- trace-column -->
          </div> <!-- tab-pane -->
        </div> <!-- tab-content -->
      </div>   <!-- files -->
    </div>     <!-- container -->
  </body>
</html>
